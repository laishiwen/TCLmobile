!function(o){"use strict";function t(o){o.touches||(o.touches=o.originalEvent.touches)}function n(o,t){t._startY=o.touches[0].pageY,t.touchScrollTop=t.$scrollArea.scrollTop()}function s(t,n){n._curY=t.touches[0].pageY,n._moveY=n._curY-n._startY,n._moveY>0?n.direction="down":n._moveY<0&&(n.direction="up");var s=Math.abs(n._moveY);""!=n.opts.loadUpFn&&n.touchScrollTop<=0&&"down"==n.direction&&!n.isLockUp&&(t.preventDefault(),n.$domUp=o("."+n.opts.domUp.domClass),n.upInsertDOM||(n.$element.prepend('<div class="'+n.opts.domUp.domClass+'"></div>'),n.upInsertDOM=!0),d(n.$domUp,0),s<=n.opts.distance?(n._offsetY=s,n.$domUp.html(n.opts.domUp.domRefresh)):s>n.opts.distance&&s<=2*n.opts.distance?(n._offsetY=n.opts.distance+.5*(s-n.opts.distance),n.$domUp.html(n.opts.domUp.domUpdate)):n._offsetY=n.opts.distance+.5*n.opts.distance+.2*(s-2*n.opts.distance),n.$domUp.css({height:n._offsetY}))}function e(t){var n=Math.abs(t._moveY);""!=t.opts.loadUpFn&&t.touchScrollTop<=0&&"down"==t.direction&&!t.isLockUp&&(d(t.$domUp,300),n>t.opts.distance?(t.$domUp.css({height:t.$domUp.children().height()}),t.$domUp.html(t.opts.domUp.domLoad),t.loading=!0,t.opts.loadUpFn(t)):t.$domUp.css({height:"0"}).on("webkitTransitionEnd transitionend",function(){t.upInsertDOM=!1,o(this).remove()}),t._moveY=0)}function i(o){o._scrollContentHeight=o.opts.scrollArea==l?c.height():o.$element[0].scrollHeight}function d(o,t){o.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}var l=window,r=document,a=o(l),c=o(r);o.fn.dropload=function(o){return new p(this,o)};var p=function(t,n){var s=this;s.$element=o(t),s.upInsertDOM=!1,s.loading=!1,s.isLockUp=!1,s.isLockDown=!1,s.isData=!0,s._scrollTop=0,s.init(n)};p.prototype.init=function(i){function d(){p.direction="up",p.$domDown.html(p.opts.domDown.domLoad),p.loading=!0,p.opts.loadDownFn(p)}var p=this;p.opts=o.extend({},{scrollArea:p.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div  id="itemmore" class="itemmore row"> 上拉加载更多</div>',domLoad:'<div class="dropload-down itemmore"><div class="dropload-load"><span class="loading"></span>加载中...</div></div>',domNoData:'<div  id="itemmore" class="itemmore row"> 暂无数据</div>'},distance:50,threshold:"",loadUpFn:"",loadDownFn:""},i),""!=p.opts.loadDownFn&&(p.$element.append('<div class="'+p.opts.domDown.domClass+'">'+p.opts.domDown.domRefresh+"</div>"),p.$domDown=o("."+p.opts.domDown.domClass)),p.opts.scrollArea==l?(p.$scrollArea=a,p._scrollContentHeight=c.height(),p._scrollWindowHeight=r.documentElement.clientHeight):(p.$scrollArea=p.opts.scrollArea,p._scrollContentHeight=p.$element[0].scrollHeight,p._scrollWindowHeight=p.$element.height()),p._scrollContentHeight<=p._scrollWindowHeight&&d(),a.on("resize",function(){p._scrollWindowHeight=p.opts.scrollArea==l?l.innerHeight:p.$element.height()}),p.$element.on("touchstart",function(o){p.loading||(t(o),n(o,p))}),p.$element.on("touchmove",function(o){p.loading||(t(o,p),s(o,p))}),p.$element.on("touchend",function(){p.loading||e(p)}),p.$scrollArea.on("scroll",function(){p._scrollTop=p.$scrollArea.scrollTop(),p._threshold=""===p.opts.threshold?Math.floor(1*p.$domDown.height()/3):p.opts.threshold,""!=p.opts.loadDownFn&&!p.loading&&!p.isLockDown&&p._scrollContentHeight-p._threshold<=p._scrollWindowHeight+p._scrollTop&&d()})},p.prototype.lock=function(o){var t=this;void 0===o?"up"==t.direction?t.isLockDown=!0:"down"==t.direction?t.isLockUp=!0:(t.isLockUp=!0,t.isLockDown=!0):"up"==o?t.isLockUp=!0:"down"==o&&(t.isLockDown=!0)},p.prototype.unlock=function(){var o=this;o.isLockUp=!1,o.isLockDown=!1},p.prototype.noData=function(){var o=this;o.isData=!1},p.prototype.resetload=function(){var t=this;"down"==t.direction&&t.upInsertDOM?t.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){t.loading=!1,t.upInsertDOM=!1,o(this).remove(),i(t)}):"up"==t.direction&&(t.loading=!1,t.isData?(t.$domDown.html(t.opts.domDown.domRefresh),i(t)):t.$domDown.html(t.opts.domDown.domNoData))}}(window.Zepto||window.jQuery);